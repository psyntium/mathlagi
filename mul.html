<!doctype html>
<html lang="en" class="h-100">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MathLagi v0.1 - Multiplication</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <meta name="theme-color" content="#7952b3">


    <style>
        .btn-secondary,
        .btn-secondary:hover,
        .btn-secondary:focus {
            color: #333;
            text-shadow: none;
            /* Prevent inheritance from `body` */
        }


        /*
 * Base structure
 */

        body {
            text-shadow: 0 .05rem .1rem rgba(0, 0, 0, .5);
            box-shadow: inset 0 0 5rem rgba(0, 0, 0, .5);
        }

        .cover-container {
            max-width: 42em;
        }


        /*
 * Header
 */

        .nav-link {
            font-weight: 700;
            color: rgba(255, 255, 255, .5);
            background-color: transparent;
        }

        .px-3 {
            overflow: auto;
        }
        
    </style>
</head>

<body class="d-flex h-100 text-center text-white bg-dark">

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-auto">
            <div>
                <h3 class="float-md-start mb-0">MathLagi : Multiplication</h3>
                
                
                <nav class="nav justify-content-end">
                <!-- <nav class="nav nav-masthead justify-content-center float-md-end"> -->
                    <a id="btnMode" class="nav-link" href="#"><i class="bi-gear-wide-connected"></i> Mode</a>
                    <a id="btnReset" class="nav-link" href="#"><i class="bi-arrow-clockwise"></i> Reset</a>
                    <a id="btnSubmitAll" class="nav-link" href="#"><i class="bi-send"></i> Done</a>
                </nav>
            </div>
        </header>

        <main class="px-3">
            <div id="math-content" class="font-monospace">

                <div class="row border-bottom border-top border-1">
                    <div id="timer" class="col align-self-start text-start">&nbsp;</div>
                    <div id="posQ" class="col align-self-center text-center">&nbsp;</div>
                    <div id="score" class="col align-self-end text-end">&nbsp;</div>
                </div>
                <div class="row">
                    <div class="col"></div>
                    <div class="col"></div>
                    <div id="l1_1" class="col">9</div>
                    <div id="l1_2" class="col">9</div>
                    <div class="col"></div>
                </div>
                <div class="row">
                    <div class="col"></div>
                    <div class="col">&times;</div>
                    <div id="l2_1" class="col">9</div>
                    <div id="l2_2" class="col">9</div>
                    <div class="col"></div>
                </div>
                <div class="row border-top border-bottom border-5">
                    <div class="col"></div>
                    <div class="col">
                        <input id="a1" type="number" class="bg-dark text-white form-control text-center p-0" maxlength="1" max="9" min="0"/>
                    </div>
                    <div class="col">
                        <input id="a2" type="number" class="bg-dark text-white form-control text-center p-0" maxlength="1" max="9" min="0"/>
                    </div>
                    <div class="col">
                        <input id="a3" type="number" class="bg-dark text-white form-control text-center p-0" maxlength="1" max="9" min="0"/>
                    </div>
                    <div id="mark" class="col"></div>
                </div>
                <div class="row border-top border-3 mt-1"></div>

            </div>
            <div class="row py-3">
                <div class="col d-grid"><button id="prevQ" type="button" class="btn btn-success btn-lg">&lt;&lt;</button></div>
                <div class="col d-grid"><button id="nextQ" type="button" class="btn btn-success btn-lg">&gt;&gt;</button></div>
            </div>
        </main>

        <footer class="mt-auto text-white-50 row d-grid">
            <button id="submit" type="button" class="btn btn-primary btn-lg">SUBMIT</button>
        </footer>
    </div>

    <div class="position-fixed top-0 start-0" style="z-index: 1000">
        <div id="toastReset" class="toast hide bg-white text-dark position-fixed top-50 start-50 translate-middle p-3" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="toast-body">
                Reset?
                <div class="mt-2 pt-2 border-top">
                    <button id="btnResetYes" type="button" class="btn btn-primary btn-sm">Yes</button>
                    <button type="button" class="btn btn-secondary btn-sm btn-close-toast" data-bs-dismiss="toast">Cancel</button>
                </div>
            </div>
        </div>
        <div id="toastSubmit" class="toast hide bg-white text-dark position-fixed top-50 start-50 translate-middle p-3" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="toast-body">
                Submit All?
                <div class="mt-2 pt-2 border-top">
                    <button id="btnSubmitAllYes" type="button" class="btn btn-primary btn-sm">Yes</button>
                    <button type="button" class="btn btn-secondary btn-sm btn-close-toast" data-bs-dismiss="toast">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <script>
        const start = 2;
        const end = 12;
        const qSize = 20;
        var currentQ = 0;
        var time = new Date().getTime();

        var qList = [];
        var aList = [];

        var stopTime = false;
        
        $(document).ready(function () {
            resizeFont();
            $("input").on("input", fixInput)
            $(window).resize(resetFont);
            init();
            
            $("#nextQ").click(nextQuestion)
            $("#prevQ").click(prevQuestion)
            $("#submit").click(checkAnswer)
            $("#btnReset").click(function () {
                show($("#toastReset"))
            })
            $("#btnSubmitAll").click(function () {
                show($("#toastSubmit"))
            })
            $("#btnResetYes").click(function() {
                hide($(this).parents(".toast"));
                init();
            })
            $("#btnSubmitAllYes").click(function() {
                hide($(this).parents(".toast"))
                checkAnswerAll()
            });

            $(".btn-close-toast").click(function () {
                hide($(this).parents(".toast"))
            })
            
        });

        function init() {
            qList = [];
            aList = [];
            for (var i = 0; i < qSize; i++) {
                const num1 = genNum(start, end);
                const num2 = genNum(start, end);
                qList.push({
                    l1: num1,
                    l2: num2
                })
                aList.push({ a: 0 })
            }
            time = new Date().getTime();
            stopTime = false;
            setTime();
            currentQ = 0
            setQuestion(currentQ);
            $(".toast").removeClass("show");
            $("#score").html("");
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ >= qSize - 1) currentQ = qSize - 1;
            setQuestion(currentQ)
        }

        function prevQuestion() {
            currentQ--;
            if (currentQ <= 0) currentQ = 0;
            setQuestion(currentQ)
        }

        function setQuestion(num) {
            const q = qList[num]
            const l1 = q.l1;
            const l2 = q.l2;
            const l1_1 = parseInt(l1 / 10);
            const l2_1 = parseInt(l2 / 10);
            const l1_2 = l1 - (l1_1 * 10);
            const l2_2 = l2 - (l2_1 * 10);

            if (l1_1) $("#l1_1").html(l1_1);
            else $("#l1_1").html("");
            $("#l1_2").html(l1_2);
            
            if (l2_1) $("#l2_1").html(l2_1);
            else $("#l2_1").html("");
            $("#l2_2").html(l2_2);

            if (currentQ === 0) {
                $("#prevQ").addClass("d-none");
            } else {
                $("#prevQ").removeClass("d-none");
            }

            if (currentQ >= qSize - 1) {
                $("#nextQ").addClass("d-none");
            } else {
                $("#nextQ").removeClass("d-none");
            }

            setAnswer();
            $("#posQ").html((currentQ + 1) + " / " + qSize)
        }

        function resetFont() {
            fs = 10;
            resizeFont();
        }

        var fs = 10;
        function resizeFont() {
            fs++;
            setFontSize(fs);
            if ($("#math-content").parent().height() + 1 < $("#math-content").parent()[0].scrollHeight) {
                fs--;
                setFontSize(fs);
                return;
            }
            if (fs < 1000) resizeFont();
        }

        function setFontSize(size) {
            $("#math-content").css({ 'font-size': size + "px" });
            $("#math-content input").css({ 'font-size': size + "px" });
            $("#timer").css({ 'font-size': parseInt(size/6) + "px" });
            $("#posQ").css({ 'font-size': parseInt(size/6) + "px" });
            $("#score").css({ 'font-size': parseInt(size/6) + "px" });
        }

        function fixInput(that) {
            $("#math-content input").each(function (index) {
                if ($(this).val() === "") return;
                if (parseInt($(this).val()) != $(this).val()) {
                    $(this).val(parseInt($(this).val()))
                }
                while ($(this).val().length > this.maxLength) {
                    $(this).val(parseInt($(this).val()/10))
                }
            });

            const el = $(that.currentTarget)[0];
            if (($(el).val() || "").length >= el.maxLength) {
                $(el).parent().next("div").children("input").focus();
            }
            saveAnswer();
        }

        function saveAnswer() {
            const a1 = parseInt($("#a1").val() || 0) * 100;
            const a2 = parseInt($("#a2").val() || 0) * 10;
            const a3 = parseInt($("#a3").val() || 0) * 1;
            const a = a1 + a2 + a3;
            aList[currentQ].a = a;
        }

        function setAnswer() {
            $("#math-content input").prop('readonly', false);
            $("#mark").html("");

            const a = aList[currentQ].a;
            var a3 = getDigit(a, 1)
            var a2 = getDigit(a, 2)
            var a1 = getDigit(a, 3)
            if (!a1) a1 = "";
            $("#a1").val(a1);
            if (!a1 && !a2) a2 = ""
            $("#a2").val(a2);
            if (!a1 && !a2 && !a3) a3 = ""
            $("#a3").val(a3);

            $("#submit").prop('disabled', false);
            if (typeof aList[currentQ].m === "boolean")
                checkAnswer()
        }

        function checkAnswer() {
            saveAnswer();
            const q = qList[currentQ];
            const a = aList[currentQ].a;
            if (q.l1 * q.l2 === a) {
                $("#mark").html("&check;").addClass("text-success").removeClass("text-danger")
                aList[currentQ].m = true;
            } else {
                $("#mark").html("&cross;").addClass("text-danger").removeClass("text-success")
                aList[currentQ].m = false;
            }
            $("#math-content input").prop('readonly', true);
            $("#submit").prop('disabled', true);
        }

        function checkAnswerAll() {
            checkAnswer();
            for (var i = 0; i < qSize; i++) {
                const q = qList[i];
                const a = aList[i].a;
                if (q.l1 * q.l2 === a) aList[i].m = true;
                else aList[i].m = false;
            }
            const c = aList.filter(function (a) {
                return a.m;
            })
            const cp = parseInt((c.length * 100) / qSize);
            $("#score").html(cp + "%")
            $(".toast").removeClass("show")
            stopTime = true;
        }

        function getDigit(num, digit) {
            num = "0000" + (num || 0).toString()
            return parseInt(num.split("").reverse()[digit - 1])
        }

        function genNum(start, end) {
            return parseInt(Math.random() * (end - start + 1)) + start;
        }

        function setTime() {
            if (stopTime) return;
            var s = parseInt((new Date().getTime() - time) / 1000);
            var m = parseInt(s/60);
            s = s % 60;
            var timer = m + ":" + ("00"+s).substr(-2);
            $("#timer").html(timer)

            setTimeout(setTime, 500);
        }

        function show(j) {
            j.show().addClass("show").removeClass("hide")
        }

        function hide(j) {
            j.hide().removeClass("show").addClass("hide")
        }
    </script>
</body>

</html>